<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Easy Food Classifier Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest"></script>
  <style>
    body { background:#f9f8ee; font-family:'Noto Sans KR',sans-serif; margin:0; }
    #app { max-width:420px; margin:28px auto; background:#fff; border-radius:19px; box-shadow:0 3px 13px #ddd; padding:24px 14px; }
    h2 { color:#155fa0; text-align:center; margin:8px 0 0 0; font-size:1.5em; }
    #inputbox{ display: flex; gap:8px; justify-content: center; margin:19px 0 0; }
    .btn{ padding:6px 14px; border-radius:8px; background:#e3f4ff; font-size:0.95em; border:1px solid #b3d7ee; cursor:pointer; }
    .btn:active{ background:#bce2fa; }
    #webcam-container{margin:14px 0 0 0; display:flex; justify-content:center;}
    #previewimg{ max-width:92%; border-radius:12px; margin:15px auto 2px auto; display:block; box-shadow:0 1px 4px #ccc; }
    .food-card { background: #ffefc7; border-radius:14px; margin:14px 0; padding:13px 16px; box-shadow:0 1px 8px #eee; font-size:1.08em; }
    .food-card strong{ color:#c37a00; font-size:1.1em; }
    @media(max-width:500px){ #app{padding:2vw 1vw;} }
  </style>
</head>
<body>
<div id="app">
  <h2>Asian Food Classifier</h2>
  <div id="inputbox">
    <input type="file" id="file-input" accept="image/*" class="btn">
    <button class="btn" id="webcam-btn">Use Webcam</button>
    <button class="btn" id="stopcam-btn" style="display:none;">Stop Webcam</button>
  </div>
  <div id="webcam-container"></div>
  <img id="previewimg" style="display:none;"/>
  <div id="output"></div>
</div>
<script>
const URL = "https://teachablemachine.withgoogle.com/models/SCrCm4nRI/";
let model, webcam, webcamOn = false;
const foodInfo = {
  // 중국
  "Dim sum": { country: "China", calorie: 360, desc: "A variety of small Chinese dishes served in steamer baskets or plates, often enjoyed as brunch with tea." },
  "Chinese Eight Treasures": { country: "China", calorie: 293, desc: "A sweet dessert pudding made with glutinous rice and assorted dried fruits and nuts." },
  "Dongpo Pork": { country: "China", calorie: 603, desc: "Braised pork belly cooked with soy sauce, sugar, and wine, resulting in rich and tender flavors." },
  "Jjamppong": { country: "China", calorie: 713, desc: "Spicy mixed seafood noodle soup with vegetables, originated in China but also popular in Korea." },
  "Kkanpunggi": { country: "China", calorie: 865, desc: "Spicy, garlicky fried chicken or shrimp, stir-fried with vegetables in Chinese-Korean cuisine." },
  "Hot Pot": { country: "China", calorie: 485, desc: "A communal dish with meats and vegetables cooked in simmering broth at the table." },
  "Mapo Tofu": { country: "China", calorie: 420, desc: "Sichuan dish of tofu and ground meat in a spicy, numbing chili and bean-based sauce." },
  "Peking Duck": { country: "China", calorie: 465, desc: "Famous duck dish praised for crispy skin, tender meat, typically served with pancakes and sweet sauce." },
  // 일본
  "Sushi": { country: "Japan", calorie: 350, desc: "Vinegared rice combined with seafood, vegetables, or egg. Japan's most iconic dish." },
  "Miso-soup": { country: "Japan", calorie: 50, desc: "Classic soup with fermented soybean paste, seaweed, tofu, and green onion." },
  "Ramen": { country: "Japan", calorie: 500, desc: "Noodle soup served in meat/fish broth with slices of meat, egg, and vegetables." },
  "Takoyaki": { country: "Japan", calorie: 400, desc: "Ball-shaped snacks with diced octopus, fried in batter, topped with sauce and bonito flakes." },
  "Tempura": { country: "Japan", calorie: 400, desc: "Seafood or vegetables battered and deep-fried for a light, crispy texture." },
  "Katsu Don": { country: "Japan", calorie: 540, desc: "Rice bowl with breaded pork cutlet and egg simmered in sauce." },
  "Okonomiyaki": { country: "Japan", calorie: 410, desc: "Savory cabbage pancake with meat/seafood and sweet sauce plus mayonnaise." },
  "Sukiyaki": { country: "Japan", calorie: 630, desc: "Hot pot of beef, tofu, and vegetables simmered in sweet soy-based broth." },
  // 한국
  "Bibimbap": { country: "Korea", calorie: 460, desc: "Rice dish topped with assorted vegetables, egg, and chili paste, served in a hot bowl." },
  "Bulgogi": { country: "Korea", calorie: 250, desc: "Grilled marinated beef or pork, savory and slightly sweet." },
  "Kimchi Jjigae": { country: "Korea", calorie: 400, desc: "Spicy stew made from kimchi, pork, and vegetables." },
  "Samgyeopsal": { country: "Korea", calorie: 180, desc: "Thick pork belly slices grilled and eaten with sauces and vegetables." },
  "Gimbap": { country: "Korea", calorie: 125, desc: "Seaweed rice roll filled with vegetables, egg, and meat. Korean-style sushi." },
  "Doenjang Jjigae": { country: "Korea", calorie: 280, desc: "Hearty stew with soybean paste, tofu, and assorted vegetables." },
  "Japchae": { country: "Korea", calorie: 220, desc: "Stir-fried glass noodles with vegetables and beef in sweet soy sauce." },
  "Tteokbokki": { country: "Korea", calorie: 480, desc: "Chewy rice cakes in spicy gochujang sauce, often with fish cake and egg." },
  // 태국
  "Pad Thai": { country: "Thailand", calorie: 357, desc: "Stir-fried rice noodles with egg, shrimp/chicken, peanuts, bean sprouts, and tamarind sauce." },
  "Tom Yum Goong": { country: "Thailand", calorie: 196, desc: "Spicy and sour shrimp soup with lemongrass, kaffir lime, and chili." },
  "Khao Pad": { country: "Thailand", calorie: 555, desc: "Thai-style fried rice with meat or seafood, egg, and vegetables." },
  "Som Tam": { country: "Thailand", calorie: 122, desc: "Spicy green papaya salad with chili, lime, fish sauce, peanuts, and tomatoes." },
  "Green Curry": { country: "Thailand", calorie: 620, desc: "Spicy curry with coconut milk, green chili, meat, and vegetables." },
  "Massaman Curry": { country: "Thailand", calorie: 530, desc: "Rich, mild curry with coconut milk, potato, peanuts, influenced by Indian spices." },
  "Pad Kra Phao": { country: "Thailand", calorie: 410, desc: "Stir-fried meat with garlic, chili, and holy basil, topped with a fried egg." },
  "Mango Sticky Rice": { country: "Thailand", calorie: 350, desc: "Sweet glutinous rice with coconut milk, served with ripe mango." }
};
tmImage.load(URL+"model.json", URL+"metadata.json").then(m=>{model=m;});
// 파일 업로드 → 판별
const finput=document.getElementById("file-input");
finput.addEventListener("change",function(){
  const f=this.files[0];
  if(!f||!model) return;
  const reader=new FileReader();
  reader.onload=function(ev){
    const img=new window.Image();
    img.onload=async function(){
      document.getElementById("previewimg").src=ev.target.result;
      document.getElementById("previewimg").style.display='block';
      showPred(img);
    };img.src=ev.target.result;
  }
  reader.readAsDataURL(f);
});
// 웹캠
const webcamBtn=document.getElementById("webcam-btn");
const stopBtn=document.getElementById("stopcam-btn");
webcamBtn.onclick=async function(){
  if(webcamOn) return;
  webcamOn=true;
  webcamBtn.style.display='none';stopBtn.style.display='inline-block';
  document.getElementById("previewimg").style.display='none';
  webcam=new tmImage.Webcam(224,224,true); await webcam.setup(); await webcam.play();
  document.getElementById("webcam-container").innerHTML='';
  document.getElementById("webcam-container").appendChild(webcam.canvas);
  webcamLoop();
}
stopBtn.onclick=function(){
  webcamOn=false; if(webcam) webcam.stop();
  document.getElementById("webcam-container").innerHTML='';
  webcamBtn.style.display='inline-block';stopBtn.style.display='none';
  document.getElementById("previewimg").style.display='none';
}
async function webcamLoop(){
  if(!webcamOn||!model) return;
  webcam.update(); showPred(webcam.canvas);
  setTimeout(webcamLoop,1500);
}
// 예측+카드
async function showPred(srcimg){
  if(!model) return;
  let pred=await model.predict(srcimg);
  let filtered=pred.filter(p=>p.probability>0.10).sort((a,b)=>b.probability-a.probability);
  if(filtered.length==0 && pred.length>0){filtered=[pred.reduce((a,b)=>a.probability>b.probability?a:b)];}
  let html='';
  filtered.forEach(p=>{
    const info=foodInfo[p.className]||{country:'-',calorie:'-',desc:'No info'};
    html+=`<div class=\"food-card\">
    <strong>${p.className}</strong> &nbsp; <b>${(p.probability*100).toFixed(1)}%</b><br>
    Country: <b>${info.country}</b> &nbsp;|&nbsp; Calories: <b>${info.calorie} kcal</b><br>
    <span style=\"color:#7b5509\">${info.desc}</span>
    </div>`;
  });
  document.getElementById("output").innerHTML=html;
}
</script>
</body>
</html>
